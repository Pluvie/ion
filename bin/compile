#!/bin/bash

# ⚡️ION⚡️ compilation script.
# Works only for Unix-like platforms.
# For Windows users, see `bin/compile.bat`.

if [[ $# -lt 1 ]]; then
  echo "Usage: bin/compile [app] options"
  exit 1
fi

COMPILER="gcc"
PLATFORM="LINUX"
ARCHITECTURE="X64"
C_STANDARD="c89"

GCC_FLAGS="-std=$C_STANDARD -pedantic -Wall -Werror"
CLANG_FLAGS="-std=$C_STANDARD -pedantic -Wall -Werror"

APP=$1
FILES=$(find app/$APP -name "*.c" -type f | tr '\n' ' ')
INCLUDE="-I ./src"
if [ -d "ion" ]; then
  INCLUDE="$INCLUDE -I ./ion" 
fi

if    [[ $COMPILER == "gcc"   ]]; then
  FLAGS=$GCC_FLAGS
elif  [[ $COMPILER == "clang" ]]; then
  FLAGS=$CLANG_FLAGS
fi

mkdir -p exe
$COMPILER $FILES $FLAGS $INCLUDE  \
  -D PLATFORM=$PLATFORM           \
  -D ARCHITECTURE=$ARCHITECTURE   \
  ${@:2}                          \
  -o exe/$APP


# To compile ⚡️ION⚡️ as a shared library run:
#
# ```
# bin/compile libion -O3 -march=native -shared -fPIC
# ```
#
# Then rename `exe/libion` to `exe/libion.so`
