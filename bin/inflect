#!/usr/bin/perl
use strict;
use warnings;

# Reads from STDIN.
while (my $input = <>) {
  # Calls the `inflect` subroutine on each match of the regex.
  # The regex searches for patterns like `container<type1, type2*>`.
  $input =~ s/<[\s]*([A-z0-9_,\s\*]+)>/inflect("$1")/eg;
  print $input
}

# Inflects all container types.
sub inflect {
  my $result = shift;
  $result =~ s/[\s]+/ /g;
  $result =~ s/[\s]*,[\s]*/_/g;
  $result =~ s/[\s]*,[\s]*/_/g;
  $result =~ s/[\s]*\*[\s]*/_p/g;
  $result =~ s/[\s]*\s+[\s]*/_/g;
  return "_".$result;
}
