#!/bin/bash

mkdir -p exe

# Go
if [ $# -eq 0 ] || [[ $1 == "go" ]]; then
  cd src/go
  go build go.go && mv go ../../exe
  cd -
fi

# Ion
if [ $# -eq 0 ] || [[ $1 == "ion" ]]; then
  cd ../..
  gcc prf/json/src/ion/ion.c    \
    -no-integrated-cpp -B ./bin \
    -std=c11 -Wall -Werror      \
    -D PLATFORM=LINUX           \
    -I ./src                    \
    -O3 -march=native           \
    -o prf/json/exe/ion
  cd -
fi

# Python
if [ $# -eq 0 ] || [[ $1 == "python" ]]; then
  rm -rf exe/python
  echo "#!/bin/bash" >> exe/python
  echo "python3 src/python/python.py" >> exe/python
  chmod +x exe/python
fi

# Ruby
if [ $# -eq 0 ] || [[ $1 == "ruby" ]]; then
  rm -rf exe/ruby
  echo "#!/bin/bash" >> exe/ruby
  echo "ruby src/ruby/ruby.rb" >> exe/ruby
  chmod +x exe/ruby
fi

# Rust
if [ $# -eq 0 ] || [[ $1 == "rust" ]]; then
  cd src/rust
  cargo build --release
  mv target/release/rust ../../exe
  rm -rf target
  cd -
fi

# SimdJSON
if [ $# -eq 0 ] || [[ $1 == "simdjson" ]]; then
  cd src/simdjson
  g++ main.cpp simdjson.cpp \
    -std=c++20              \
    -O3 -march=native       \
    -o ../../exe/simdjson
  cd -
fi
