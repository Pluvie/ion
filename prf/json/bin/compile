#!/bin/bash

mkdir -p exe

# Go
if [ $# -eq 0 ] || [[ $1 == "go" ]]; then
  cd src/go
  go build go.go
  mv go ../../exe
  cd -
fi

# Ion
if [ $# -eq 0 ] || [[ $1 == "ion" ]]; then
  cd ../..
  mkdir -p tmp
  gcc prf/json/src/ion/ion.c -I ./src -Wall -Werror -E  |   \
  python3 bin/ion.py > tmp/ion.c                            &&
  gcc tmp/ion.c -I ./src -Wall -Werror                      \
    -O3 -march=native                                       \
    -o prf/json/exe/ion
  rm tmp/ion.c
  cd -
fi

# Python
if [ $# -eq 0 ] || [[ $1 == "python" ]]; then
  rm -rf exe/python
  echo "#!/bin/bash" >> exe/python
  echo "python3 src/python/python.py" >> exe/python
  chmod +x exe/python
fi

# Ruby
if [ $# -eq 0 ] || [[ $1 == "ruby" ]]; then
  rm -rf exe/ruby
  echo "#!/bin/bash" >> exe/ruby
  echo "ruby src/ruby/ruby.rb" >> exe/ruby
  chmod +x exe/ruby
fi

# Rust
if [ $# -eq 0 ] || [[ $1 == "rust" ]]; then
  cd src/rust
  cargo build --release
  mv target/release/rust ../../exe
  rm -rf target
  cd -
fi
